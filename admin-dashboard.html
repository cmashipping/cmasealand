<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBN7fyXXqP1287sNU3YooVmvxRoPd4mcho",
    authDomain: "cma-sea-land-bb064.firebaseapp.com",
    projectId: "cma-sea-land-bb064"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const tabs = ['companies', 'providers', 'drivers'];

  function showTab(tab) {
    document.querySelectorAll('.tab').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(div => div.style.display = 'none');
    document.querySelector(`.tab[onclick*='${tab}']`).classList.add('active');
    document.getElementById(tab).style.display = 'block';
  }

  function renderCard(type, data) {
    const name = data.fullName || data.companyName || data.providerName || '—';
    let html = `<div class="card">
      <h3>${name}</h3>
      <p><strong>Activity:</strong> ${data.activity || '—'}</p>
      <p><strong>Phone:</strong> ${data.phone || (data.phoneNumbers?.join(', ') || '—')}</p>
      <p><strong>Email:</strong> ${data.email || '—'}</p>
      <p><strong>Country:</strong> ${data.country || '—'}</p>`;

    if (data.documents && typeof data.documents === 'object') {
      for (const key in data.documents) {
        const doc = data.documents[key];
        if (doc && doc.name && doc.url) {
          html += `<p><strong>${doc.name}:</strong> 
            <a href="${doc.url}" target="_blank">View</a> 
            ${doc.expiry ? `(Exp: ${doc.expiry})` : ''}
          </p>`;
        }
      }
    } else {
      // fallback if documents not grouped
      if (data.licenseURL) {
        html += `<p><strong>License:</strong> <a href="${data.licenseURL}" target="_blank">View</a> (Exp: ${data.licenseExpiry || '—'})</p>`;
      }
      if (data.taxURL) {
        html += `<p><strong>Tax:</strong> <a href="${data.taxURL}" target="_blank">View</a> (Exp: ${data.taxExpiry || '—'})</p>`;
      }
    }

    html += `
      <p><strong>Status:</strong> ${data.status || '—'}</p>
      <p><strong>Date:</strong> ${data.createdAt || '—'}</p>
      <textarea placeholder="Comment (e.g. missing documents)"></textarea>
      <div class="btn-group">
        <button class="btn-accept">Accept</button>
        <button class="btn-reject">Reject</button>
      </div>
    </div>`;

    return html;
  }

  async function loadData(type) {
    const container = document.getElementById(type);
    container.innerHTML = '';
    try {
      const snapshot = await db.collection(`${type}_requests`).get();
      snapshot.forEach(doc => {
        const data = doc.data();
        container.innerHTML += renderCard(type, data);
      });
    } catch (err) {
      console.error(`Error loading ${type}_requests:`, err);
      container.innerHTML = `<p style="color:red;">Error loading ${type}</p>`;
    }
  }

  tabs.forEach(loadData);
</script>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBN7fyXXqP1287sNU3YooVmvxRoPd4mcho",
    authDomain: "cma-sea-land-bb064.firebaseapp.com",
    projectId: "cma-sea-land-bb064"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  async function handleLogin(e) {
    e.preventDefault();
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();

    const types = [
      { type: "company", collection: "company_requests", dashboard: "dashboard-company.html" },
      { type: "provider", collection: "provider_requests", dashboard: "dashboard-provider.html" },
      { type: "driver", collection: "driver_requests", dashboard: "dashboard-driver.html" }
    ];

    for (const user of types) {
      const snapshot = await db.collection(user.collection).where("email", "==", email).get();
      if (!snapshot.empty) {
        const doc = snapshot.docs[0];
        const data = doc.data();

        if (data.password !== password) {
          return alert("❌ كلمة المرور غير صحيحة");
        }

        if (data.status !== "accepted") {
          return alert(`⚠️ حسابك ${data.status === "rejected" ? "مرفوض" : "قيد المعالجة"}، يرجى الانتظار`);
        }

        // Save login state and redirect
        localStorage.setItem("userLoggedIn", "true");
        localStorage.setItem("userType", user.type);
        localStorage.setItem("userEmail", email);
        alert("✅ تسجيل الدخول ناجح");
        window.location.href = user.dashboard;
        return;
      }
    }

    alert("❌ لم يتم العثور على الحساب");
  }
</script>
